# Data Accessibility Validation Plan (Pre-Implementation)

## 1. 목적
- 구현 착수 전 데이터 소스 접근성이 "운영 가능한 수준"인지 검증한다.
- 단순 연결 성공이 아닌, 가용성/지연/정합성/최신성/제약을 수치로 확인한다.
- 최종 결과는 Go/No-Go로 판정한다.

## 2. 검증 대상
### 2.1 소스
- FinanceDataReader (전 자산 1순위)
  - KS200 (KOSPI200)
  - 005930 (삼성전자)
  - 000660 (SK하이닉스)
  - SOXL
  - BTC/KRW (fallback: BTC/USD)
  - GC=F (Gold)
  - SI=F (Silver)
- 참고: Hantoo(한국투자증권) REST API는 배포 직전(v0.9+)에 fallback으로 추가 예정이며, 본 검증 범위에 포함하지 않는다.

### 2.2 검증 관점
- 조회 가능 범위(히스토리컬 depth)
- 최신성(데이터 반영 시점)
- 데이터 품질(결측/중복/이상치)
- 호출 안정성(실패율/재시도 효과)

## 3. 사전 조건
- Python 런타임 및 수집 스크립트 실행 가능
- Railway PostgreSQL 연결 정보 준비
- 테스트 로그/결과 저장 경로 확보

## 4. 실행 단계
## 4.1 환경 점검
- FDR 단일 요청 확인
- PostgreSQL 연결 및 임시 테이블 쓰기/삭제 확인

완료 기준:
- 2개 항목 모두 성공

## 4.2 스모크 테스트 (접근 가능 여부)
- 각 자산 30영업일 일봉 1회 조회
- 기록 항목:
  - 요청 시각
  - 응답 시간(ms)
  - 성공/실패
  - 반환 컬럼 일치 여부

완료 기준:
- 전 자산 조회 성공
- 필수 컬럼(Open/High/Low/Close/Volume/Date) 존재

## 4.3 백필 테스트 (실운영 관점)
- 각 자산 최근 3년 데이터 조회
- 검증 항목:
  - 날짜 오름차순 정렬
  - 중복 키(asset_id, date) 여부
  - 결측일 비율
  - 음수 가격/역전 고저가(high < low) 여부

완료 기준:
- 중복 0건
- 음수/역전 0건
- 결측률 임계치 이내

## 4.4 안정성 테스트 (반복 호출)
- 자산별 동일 요청 20회 반복
- 재시도 없는 경우 실패율 측정
- 재시도(지수 백오프) 적용 후 실패율 재측정

완료 기준:
- 최종 실패율 1% 이하
- 재시도 정책 적용 시 개선 확인

## 4.5 최신성 테스트
- 당일 또는 직전 영업일 종가 반영 시점 측정
- 소스별 갱신 지연 시간 기록

완료 기준:
- 정의된 SLA 내 반영

## 5. 판정 기준 (Gate)
- 접근 성공률 >= 99%
- 반복 호출 실패율 <= 1%
- 3년 백필 결측률 <= 0.5% (예외 사유 문서화)
- 응답시간 p95 <= 2000ms
- 데이터 품질 치명 오류(중복/음수/고저역전) 0건

판정 규칙:
- 모든 항목 통과: Go
- 치명 오류 존재 또는 핵심 임계치 미달: No-Go
- 부분 미달: Conditional Go (보완 작업과 일정 확정 필요)

## 6. 실패 시 대응 전략
- FDR 실패:
  - 지수 백오프 재시도
  - 자산 단위 지연 처리
- 지속 실패:
  - 배치 부분 성공 허용
  - 알림 발송
  - 재처리 큐 등록
- 향후(v0.9+): Hantoo REST API fallback 추가 시 국내주식 이중화 확보

## 7. 산출물
- `docs/data-accessibility-plan.md` (본 문서)
- `docs/data-accessibility-report.md` (실측 결과)

보고서 최소 필드:
- 테스트 일시/환경
- 자산별 결과 표
- 실패 사례 로그 요약
- Gate 판정 (Go/No-Go/Conditional Go)
- 구현 착수 권고안

## 8. 책임과 일정
- 소유: Data Pipeline 트랙
- 예상 소요: 1~2일
- 구현 착수 조건:
  - Report가 Go 또는 승인된 Conditional Go일 것

## 9. 명시적 가정
- 본 검증은 "데이터 접근성"만 다루며 전략 성능 검증은 포함하지 않는다.
- 비용/라이선스/법적 이슈는 별도 컴플라이언스 체크 트랙에서 검토한다.
